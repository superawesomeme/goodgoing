<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Good Going</title>
  <style>
    :root{
      --bg-green-1:#166534; --bg-green-2:#14532d; /* turf stripes */
      --text:#e5e7eb; --muted:#cbd5e1;
      --card:rgba(255,255,255,.08); --card-border:rgba(255,255,255,.22);
      --shadow:0 20px 45px rgba(0,0,0,.40);
      --accent:#fbbf24;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial; color:var(--text);
      background:repeating-linear-gradient(90deg,var(--bg-green-1) 0 64px,var(--bg-green-2) 64px 128px); overflow-x:hidden}
    body::before{content:""; position:fixed; inset:0; pointer-events:none; background:radial-gradient(circle at 50% 120%, transparent 60%, rgba(0,0,0,.45) 100%)}

    .container{position:relative; max-width:1200px; margin:0 auto; padding:24px 20px 64px}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0}
    h1{margin:0; font-weight:900; letter-spacing:-.02em; font-size:clamp(20px,3vw,30px); text-shadow:0 1px 0 rgba(0,0,0,.3)}
    .hint{color:var(--muted); font-size:12px; opacity:.9}
    .options-btn{height:36px; padding:0 12px; border-radius:10px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.08); color:#fff; cursor:pointer}

    .grid{display:grid; grid-template-columns:1fr; gap:20px}
    /* iPad: single column; desktop: 2 columns */
    @media (min-width:1200px){.grid{grid-template-columns:auto 26rem}}

    /* Frosted cards */
    .card{background:var(--card); -webkit-backdrop-filter:blur(16px); backdrop-filter:blur(16px); border:1px solid var(--card-border); border-radius:24px; box-shadow:inset 0 1px 1px rgba(255,255,255,.18), var(--shadow)}

    /* Reels */
    .reels{display:grid; grid-template-columns:repeat(3,auto); column-gap:24px; align-items:end; justify-content:center}
    .reel{position:relative; width:220px; aspect-ratio:4/5; border-radius:24px; overflow:hidden; background:rgba(255,255,255,.06); -webkit-backdrop-filter:blur(12px); backdrop-filter:blur(12px); border:1px solid rgba(255,255,255,.22); box-shadow:inset 0 1px 1px rgba(255,255,255,.18), 0 8px 24px rgba(0,0,0,.35)}
    .reel .glow{position:absolute; inset:0; pointer-events:none}
    .reel .glow i{position:absolute; left:50%; transform:translateX(-50%); top:-96px; width:180%; height:192px; border-radius:999px; filter:blur(36px); opacity:.4}
    .reel .mult{position:absolute; top:10px; right:10px; z-index:6; height:34px; min-width:34px; padding:0 10px; border-radius:999px; display:grid; place-items:center; font-weight:900; font-size:14px; color:#111; border:1px solid rgba(0,0,0,.25); box-shadow:0 6px 12px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.6)}
    /* bronze / silver / gold per reel */
    #reel0 .mult{background:linear-gradient(135deg,#ffb347,#f97316)}
    #reel1 .mult{background:linear-gradient(135deg,#e5e7eb,#9ca3af)}
    #reel2 .mult{background:linear-gradient(135deg,#fde68a,#f59e0b)}

    .reel .slot{display:grid; place-items:center; height:100%}
    .reel .label{position:absolute; left:0; right:0; bottom:0; text-align:center; padding:8px 10px; font-weight:700; background:linear-gradient(to top, rgba(0,0,0,.7), rgba(0,0,0,.1));}
    .dot{display:inline-block; width:12px; height:12px; border-radius:50%; vertical-align:-2px; margin-right:8px; box-shadow:inset 0 0 0 2px rgba(255,255,255,.35)}

    /* Controls under reels */
    .controls{display:flex; flex-direction:row; justify-content:center; align-items:center; gap:12px; width:100%; margin-top:16px; flex-wrap:wrap}
    .btn{height:56px; width:180px; border-radius:16px; border:1px solid rgba(0,0,0,.12); font-weight:900; letter-spacing:.02em; cursor:pointer}
    .btn.spin{background:linear-gradient(135deg,var(--accent),#ef4444); color:#111; box-shadow:0 12px 24px rgba(0,0,0,.35)}
    .btn.spin:disabled{opacity:.7; cursor:not-allowed; background:#475569; color:#e2e8f0; border-color:#475569}
    .btn.reset{background:rgba(255,255,255,.1); color:#e2e8f0; border:1px solid rgba(255,255,255,.15)}
    .btn.options{background:rgba(255,255,255,.1); color:#e2e8f0; border:1px solid rgba(255,255,255,.15); font-size:20px}
    .status{font-size:12px; color:var(--muted); text-align:center; margin-top:8px}
/* badge for non-zero 'This spin' */
.spin-badge{display:inline-grid; place-items:center; min-width:28px; height:28px; padding:0 6px; border-radius:9999px; background:#fff; color:#111; font-weight:900; box-shadow:0 2px 6px rgba(0,0,0,.35)}

    /* Scoreboard */
    aside.score{padding:20px}
    .score-head{display:grid; grid-template-columns:auto auto auto 1fr auto auto; gap:10px; font-size:12px; color:var(--muted); padding-bottom:8px; border-bottom:1px solid rgba(255,255,255,.12); font-weight:700}
    .row{display:grid; grid-template-columns:auto auto auto 1fr auto auto; gap:10px; align-items:center; padding:10px 0; border-bottom:1px solid rgba(255,255,255,.07)}
    .bar{position:relative; height:12px; border-radius:999px; background:rgba(255,255,255,.10); overflow:hidden}
    .bar > i{position:absolute; left:0; top:0; height:100%; border-radius:999px; box-shadow:inset 0 0 0 1px rgba(0,0,0,.1)}
    .tok{display:inline-block; min-width:28px; text-align:center; padding:2px 6px; font-weight:800; border-radius:999px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.2)}
    .gamble{height:28px; padding:0 10px; border-radius:12px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.1); color:#fff; font-weight:800; cursor:pointer}
    .gamble[disabled]{opacity:.5; cursor:not-allowed}
    .armed{background:linear-gradient(135deg,#22c55e,#16a34a); color:#072b18; border-color:#0f5132}

    /* Wobble for spin feel */
    @keyframes wobble{0%,100%{transform:translateY(0) rotate(0deg)}25%{transform:translateY(-2%) rotate(-1.1deg)}50%{transform:translateY(.6%) rotate(.9deg)}75%{transform:translateY(-1%) rotate(-.7deg)}}
    .wobble{animation:wobble .7s ease-in-out infinite}

    /* Modal */
    .backdrop{position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; place-items:center; z-index:50}
    .backdrop.show{display:grid}
    .modal{width:min(720px,92vw); padding:20px; border-radius:16px}
    .modal.card{background:var(--card); -webkit-backdrop-filter:blur(18px); backdrop-filter:blur(18px); border:1px solid var(--card-border)}
    .modal h3{margin:0 0 8px; font-size:20px}
    .color-grid{display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:10px; margin:12px 0}
    .color-opt{display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:12px; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.06)}
    .modal-actions{display:flex; gap:10px; justify-content:flex-end; margin-top:12px}
    .sm-btn{height:40px; padding:0 14px; border-radius:10px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.1); color:#fff; font-weight:800; cursor:pointer}
    .primary{background:linear-gradient(135deg,var(--accent),#ef4444); color:#111; border-color:rgba(0,0,0,.2)}
    .note{font-size:12px; color:var(--muted); margin-top:6px}

    /* Responsive tweaks */
    @media (max-width:820px){ .reel{width:190px} .btn{width:150px} }
  </style>
  <script defer src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <div style="display:flex; align-items:center; gap:12px">
        <h1>Good Going</h1>
      </div>
    </header>

    <main class="grid">
      <section>
        <div class="card" style="padding:20px;">
          <div class="reels">
            <div class="reel" id="reel0">
              <div class="glow"><i style="background:radial-gradient(ellipse at center, #fff3 0, transparent 60%)"></i></div>
              <div class="mult">x1</div>
              <div class="slot"></div>
              <div class="label"><span class="dot"></span><span class="label-text"></span></div>
            </div>
            <div class="reel" id="reel1">
              <div class="glow"><i style="background:radial-gradient(ellipse at center, #fff3 0, transparent 60%)"></i></div>
              <div class="mult">x2</div>
              <div class="slot"></div>
              <div class="label"><span class="dot"></span><span class="label-text"></span></div>
            </div>
            <div class="reel" id="reel2">
              <div class="glow"><i style="background:radial-gradient(ellipse at center, #fff3 0, transparent 60%)"></i></div>
              <div class="mult">x3</div>
              <div class="slot"></div>
              <div class="label"><span class="dot"></span><span class="label-text"></span></div>
            </div>
          </div>
          <div class="controls">
            <button class="btn spin" id="btnSpin">SPIN</button>
            <button class="btn reset" id="btnReset">RESET</button>
            <button class="btn options" id="btnOptions" title="Options">⚙️</button>
          </div>
          <div class="status" id="status">Press SPIN to play!</div>
        </div>
      </section>

      <aside class="card score">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px">
          <h2 style="margin:0; font-size:20px; font-weight:800">Score Card</h2>
        </div>
        <div class="score-head">
          <div>Colour</div>
          <div>Tokens</div>
          <div>Gamble</div>
          <div>Progress</div>
          <div style="text-align:right; width:56px">This spin</div>
          <div style="text-align:right; width:56px">Total</div>
        </div>
        <div id="scoreRows"></div>
      </aside>
    </main>

    <footer style="text-align:center; font-size:12px; color:#cbd5e1; padding:12px 0 0">Tip: Use tokens to <strong>ARM</strong> a colour: next time that colour hits, its points for that spin are doubled. Applying new options resets the game.</footer>
  </div>

  <!-- Options Modal -->
  <div class="backdrop" id="modal">
    <div class="modal card">
      <h3>Game Setup</h3>
      <p style="margin:6px 0 0">Select colours in play:</p>
      <div class="color-grid" id="colourGrid"></div>
      <div class="modal-actions">
        <button class="sm-btn" id="btnCancel">Cancel</button>
        <button class="sm-btn primary" id="btnApply">Apply & Reset</button>
      </div>
      <div class="note">Changing colours resets totals and tokens (4 per colour).</div>
    </div>
  </div>

  <script>
  // --- Data ------------------------------------------------------------------
  const COLORS = [
    { name: 'Red',    hex: '#ef4444' },
    { name: 'Green',  hex: '#22c55e' },
    { name: 'Blue',   hex: '#3b82f6' },
    { name: 'Yellow', hex: '#eab308' },
    { name: 'Pink',   hex: '#ec4899' },
    { name: 'Brown',  hex: '#92400e' },
    { name: 'White',  hex: '#ffffff' },
    { name: 'Black',  hex: '#000000' },
  ];
  const REEL_WEIGHTS = [1,2,3];
  const newPoints = () => Object.fromEntries(COLORS.map(c=>[c.name,0]));

  // --- Shading util ----------------------------------------------------------
  const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));
  const hexToRgb=(hex)=>{let h=hex.replace('#',''); if(h.length===3) h=h.split('').map(x=>x+x).join(''); const num=parseInt(h,16); return {r:(num>>16)&255,g:(num>>8)&255,b:num&255}};
  const rgbToHex=(r,g,b)=>`#${[r,g,b].map(v=>clamp(Math.round(v),0,255).toString(16).padStart(2,'0')).join('')}`;
  const shade=(hex,p)=>{const {r,g,b}=hexToRgb(hex); const t=p<0?0:255; const P=Math.abs(p)/100; return rgbToHex(r+(t-r)*P, g+(t-g)*P, b+(t-b)*P)};

  // --- Horseshoe (no rivets) -------------------------------------------------
  function horseshoeSVG(color){
    const uid = Math.random().toString(36).slice(2);
    const rimLight = shade(color,35), rimDark = shade(color,-45);
    const light = shade(color,28), dark = shade(color,-28);
    const outerPath = "M50 7C24 7 7 24 7 50v32h18V50c0-13.8 11.2-25 25-25s25 11.2 25 25v32h18V50C93 24 76 7 50 7Z";
    const innerPath = "M50 23c-14 0-25 11-25 25v34h12V48c0-7.2 5.8-13 13-13s13 5.8 13 13v34h12V48c0-14-11-25-25-25Z";
    return `
    <svg viewBox="0 0 100 100" width="120" height="120" style="filter:drop-shadow(0 8px 10px rgba(0,0,0,.35))">
      <defs>
        <linearGradient id="body-${uid}" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="${rimLight}"/>
          <stop offset="38%" stop-color="${light}"/>
          <stop offset="100%" stop-color="${dark}"/>
        </linearGradient>
        <linearGradient id="rim-${uid}" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="${rimLight}"/>
          <stop offset="100%" stop-color="${rimDark}"/>
        </linearGradient>
        <linearGradient id="bevel-${uid}" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="rgba(255,255,255,.85)"/>
          <stop offset="20%" stop-color="rgba(255,255,255,.35)"/>
          <stop offset="60%" stop-color="rgba(255,255,255,.15)"/>
          <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
        </linearGradient>
      </defs>
      <path fill="url(#body-${uid})" fill-rule="evenodd" d="${outerPath} ${innerPath}" opacity=".98"/>
      <path d="${outerPath}" fill="none" stroke="url(#rim-${uid})" stroke-width="2.5" opacity=".9"/>
      <path d="${innerPath}" fill="url(#bevel-${uid})" opacity=".65"/>
    </svg>`;
  }

  // --- State -----------------------------------------------------------------
  let ACTIVE_INDEXES = COLORS.map((_,i)=>i); // default: all colours
  let reelPos=[0,1,2]; // positions within ACTIVE_INDEXES
  let spinning=false; let spinPoints=newPoints(); let totals=newPoints();
  let tokens={}; // colour name -> remaining tokens
  let pending={}; // colour name -> true if armed

  const $ = (sel,root=document)=>root.querySelector(sel);
  const $$ = (sel,root=document)=>Array.from(root.querySelectorAll(sel));

  const reelEls = [$('#reel0'), $('#reel1'), $('#reel2')];
  const btnSpin = $('#btnSpin');
  const btnReset = $('#btnReset');
  const statusEl = $('#status');
  const scoreRowsEl = $('#scoreRows');
  const btnOptions = $('#btnOptions');
  const modal = $('#modal');
  const colourGrid = $('#colourGrid');
  const btnApply = $('#btnApply');
  const btnCancel = $('#btnCancel');

  // Build scoreboard rows for active colours
  const rows = {}; // name -> refs
  function buildScoreboard(){
    scoreRowsEl.innerHTML='';
    Object.keys(rows).forEach(k=>delete rows[k]);
    const activeNames = ACTIVE_INDEXES.map(i=>COLORS[i].name);
    activeNames.forEach(name=>{
      const c = COLORS.find(x=>x.name===name);
      const row=document.createElement('div'); row.className='row';
      const nameCell=document.createElement('div'); nameCell.innerHTML = `<span class=\"dot\" style=\"background:${c.hex}\"></span><span style=\"font-weight:600;\">${c.name}</span>`;
      const tokCell=document.createElement('div'); tokCell.innerHTML = `<span class=\"tok\">${tokens[name]??4}</span>`;
      const gambleCell=document.createElement('div');
      const gBtn=document.createElement('button'); gBtn.className='gamble'; gBtn.textContent='GAMBLE'; gambleCell.appendChild(gBtn);
      const bar=document.createElement('div'); bar.className='bar'; bar.innerHTML='<i></i>';
      const spin=document.createElement('div'); spin.style.cssText='text-align:right;width:56px;font-weight:700'; spin.textContent='0';
      const total=document.createElement('div'); total.style.cssText='text-align:right;width:56px;font-weight:700'; total.textContent='0';
      row.append(nameCell, tokCell, gambleCell, bar, spin, total); scoreRowsEl.appendChild(row);
      rows[name]={ row, tok:tokCell.firstElementChild, gamble:gBtn, bar:bar.firstElementChild, spin, total };
      gBtn.addEventListener('click', ()=>armGamble(name));
    });
    updateGambleButtons();
  }

  function resetTokens(){
    tokens={}; pending={};
    ACTIVE_INDEXES.forEach(i=>{ const n=COLORS[i].name; tokens[n]=4; pending[n]=false; });
  }

  function updateGambleButtons(){
    const activeNames = ACTIVE_INDEXES.map(i=>COLORS[i].name);
    activeNames.forEach(name=>{
      const r = rows[name]; if(!r) return;
      r.tok.textContent = String(tokens[name]??0);
      if (pending[name]){
        r.gamble.textContent = 'ARMED';
        r.gamble.classList.add('armed');
        r.gamble.disabled = true;
      } else {
        r.gamble.textContent = 'GAMBLE';
        r.gamble.classList.remove('armed');
        r.gamble.disabled = (tokens[name]||0) <= 0;
      }
    });
  }

  function armGamble(name){
    if ((tokens[name]||0) <= 0 || pending[name]) return;
    tokens[name] -= 1; pending[name] = true; updateGambleButtons();
    statusEl.textContent = `${name} armed: next hit doubles!`;
  }

  function renderReel(i){
    const pos=reelPos[i] % ACTIVE_INDEXES.length; const col=COLORS[ACTIVE_INDEXES[pos]]; const reel=reelEls[i];
    const slot=$('.slot', reel); slot.innerHTML = horseshoeSVG(col.hex);
    if (spinning) slot.firstElementChild.classList.add('wobble'); else slot.firstElementChild.classList.remove('wobble');
    $('.label .dot', reel).style.background = col.hex;
    $('.label .label-text', reel).textContent = col.name;
  }

  function renderAll(){
    for(let i=0;i<3;i++) renderReel(i);
    const maxTotal = Math.max(1, ...ACTIVE_INDEXES.map(i=>totals[COLORS[i].name]||0));
    ACTIVE_INDEXES.forEach(i=>{
      const c=COLORS[i]; const r=rows[c.name]; if(!r) return;
      { const v = spinPoints[c.name]||0; if(v>0){ r.spin.innerHTML = `<span class=\"spin-badge\">${v}</span>`; } else { r.spin.textContent = '0'; } }
      r.total.textContent = String(totals[c.name]||0);
      const pct = Math.min(100, Math.round((totals[c.name]||0)/maxTotal*100));
      r.bar.style.width = pct + '%';
      r.bar.style.background = c.hex;
    });
    updateGambleButtons();
  }

  // Confetti helpers ----------------------------------------------------------
  function fireConfetti(targetIdx){
    const colors = targetIdx.map(i=>COLORS[i].hex);
    const base={particleCount:100, spread:70, startVelocity:55, ticks:200, gravity:.9, scalar:.9, colors, disableForReducedMotion:true};
    confetti({...base, origin:{x:.15,y:.2}}); confetti({...base, origin:{x:.5,y:.12}}); confetti({...base, origin:{x:.85,y:.2}});
    setTimeout(()=>confetti({...base, particleCount:70, origin:{x:.5,y:.18}}),220);
  }
  function fireMegaBurst(targetIndex){
    const main=COLORS[targetIndex].hex; const colors=[main,'#fbbf24','#ffffff'];
    const burst=(opts={})=>confetti({particleCount:180, spread:90, startVelocity:70, ticks:220, gravity:.8, scalar:1.1, colors, disableForReducedMotion:true, ...opts});
    burst({origin:{x:.5,y:.3}}); setTimeout(()=>burst({origin:{x:.25,y:.2}}),120); setTimeout(()=>burst({origin:{x:.75,y:.2}}),240);
    setTimeout(()=>confetti({particleCount:420, spread:360, startVelocity:55, ticks:260, gravity:.95, scalar:1.2, colors, disableForReducedMotion:true, origin:{x:.5,y:.5}}),380);
    const end=Date.now()+700; (function frame(){ confetti({particleCount:24, angle:60, spread:50, origin:{x:0,y:.8}, colors}); confetti({particleCount:24, angle:120, spread:50, origin:{x:1,y:.8}, colors}); if(Date.now()<end) requestAnimationFrame(frame); })();
  }

  // Helpers -------------------------------------------------------------------
  function randPos(){ return Math.floor(Math.random()*ACTIVE_INDEXES.length) }
  function resetReelsForActive(){ reelPos=[0,1,2].map((p)=> ACTIVE_INDEXES.length? p % ACTIVE_INDEXES.length : 0); }

  // Spin logic ----------------------------------------------------------------
  let intervals=[null,null,null];
  let stopCounter=0;
  function startSpin(){
    if(spinning || ACTIVE_INDEXES.length===0) return; spinning=true; btnSpin.disabled=true; statusEl.textContent='Spinning…';
    // clear previous spin points for active only
    spinPoints=newPoints();
    const targetPos=[randPos(), randPos(), randPos()];
    stopCounter=0;

    REEL_WEIGHTS.forEach((w,i)=>{
      const speed=80+i*30; const duration=1200+i*500+Math.floor(Math.random()*400);
      intervals[i]=setInterval(()=>{reelPos[i]=(reelPos[i]+1)%ACTIVE_INDEXES.length; renderReel(i);}, speed);
      setTimeout(()=>{
        clearInterval(intervals[i]); intervals[i]=null; reelPos[i]=targetPos[i]; renderReel(i);
        stopCounter++; if(stopCounter===3){
          const targetIdx = targetPos.map(p=>ACTIVE_INDEXES[p]);
          // score base
          for(let r=0;r<3;r++){ const colour=COLORS[targetIdx[r]].name; spinPoints[colour]+=REEL_WEIGHTS[r]; }
          // apply gamble doubles
          ACTIVE_INDEXES.forEach(ci=>{
            const name=COLORS[ci].name; if(pending[name] && (spinPoints[name]||0)>0){ spinPoints[name]*=2; pending[name]=false; }
          });
          // add to totals
          Object.keys(spinPoints).forEach(k=> totals[k]=(totals[k]||0)+ (spinPoints[k]||0));
          // confetti & finish
          const allMatch = targetIdx[0]===targetIdx[1] && targetIdx[1]===targetIdx[2];
          if(allMatch) fireMegaBurst(targetIdx[0]); else fireConfetti(targetIdx);
          spinning=false; btnSpin.disabled=false; statusEl.textContent='Press SPIN to play!';
          renderAll();
        }
      }, duration);
    });
    renderAll();
  }

  function resetAll(){
    intervals.forEach(t=>t&&clearInterval(t));
    spinning=false; btnSpin.disabled=false; statusEl.textContent='Press SPIN to play!';
    spinPoints=newPoints(); totals=newPoints(); resetTokens(); resetReelsForActive(); buildScoreboard(); renderAll();
  }

  btnSpin.addEventListener('click', startSpin);
  btnReset.addEventListener('click', resetAll);

  // Options modal --------------------------------------------------------------
  function openModal(){ modal.classList.add('show'); buildOptions(); }
  function closeModal(){ modal.classList.remove('show'); }
  function buildOptions(){
    colourGrid.innerHTML='';
    COLORS.forEach((c,idx)=>{
      const wrap=document.createElement('label'); wrap.className='color-opt';
      const cb=document.createElement('input'); cb.type='checkbox'; cb.checked = ACTIVE_INDEXES.includes(idx);
      const dot=document.createElement('span'); dot.className='dot'; dot.style.background=c.hex;
      const name=document.createElement('span'); name.textContent=c.name; name.style.fontWeight='700'; 
      wrap.append(cb,dot,name); colourGrid.appendChild(wrap);
      wrap.dataset.idx=idx;
    });
  }
  function applyOptions(){
    const selected=[]; $$('#colourGrid label').forEach(l=>{ const cb=l.querySelector('input'); if(cb.checked) selected.push(Number(l.dataset.idx)); });
    if(selected.length===0){ alert('Please select at least one colour.'); return; }
    ACTIVE_INDEXES = selected;
    resetAll();
    closeModal();
  }

  btnOptions.addEventListener('click', openModal);
  btnCancel.addEventListener('click', closeModal);
  btnApply.addEventListener('click', applyOptions);

  // Init ----------------------------------------------------------------------
  resetTokens(); buildScoreboard(); resetReelsForActive(); renderAll();
  // Show setup on first load
  openModal();
  </script>
</body>
</html>
